<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contact - TP Int√©gration 2</title>
<link rel="stylesheet" href="style.css">

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
/* ===== General ===== */
:root{
    --bg-dark: linear-gradient(135deg,#1e3c72,#2a5298);
    --bg-light: linear-gradient(135deg,#f0f2f5,#c3cfe2);
    --text-dark:#fff;
    --text-light:#222;
    --glass-dark: rgba(255,255,255,0.1);
    --glass-light: rgba(255,255,255,0.6);
    --accent:#00c6ff;
}

body{
    margin:0;
    font-family:'Segoe UI', sans-serif;
    background: var(--bg-dark);
    color: var(--text-dark);
    transition:0.4s;
}

body.light-mode{
    background: var(--bg-light);
    color: var(--text-light);
}

/* ===== Header ===== */
header{
    padding:20px;
    text-align:center;
    backdrop-filter: blur(10px);
    background:#007bff;
    color:white;
    border-bottom-left-radius:20px;
    border-bottom-right-radius:20px;
}

header h1{
    margin:0;
    font-size:28px;
}

header p{
    margin:5px 0 0 0;
    font-size:14px;
}

/* ===== Navbar ===== */
.navbar ul{
    display:flex;
    justify-content:center;
    list-style:none;
    padding:0;
    margin:10px 0 0 0;
}

.navbar li{
    margin:0 15px;
}

.navbar a{
    color:white;
    text-decoration:none;
    font-weight:bold;
}

body.light-mode .navbar a{
    color:#222;
}

/* ===== Map container ===== */
.map-container{
    width:90%;
    max-width:900px;
    margin:20px auto;
    border-radius:20px;
    overflow:visible; /* important pour le marqueur */
    backdrop-filter: blur(15px);
    background: var(--glass-dark);
    box-shadow:0 8px 32px rgba(0,0,0,0.2);
}

body.light-mode .map-container{
    background: var(--glass-light);
}

#map{
    width:100%;
    height:400px;
    border-radius:20px;
}

/* ===== Buttons ===== */
.btn{
    display:block;
    width:220px;
    margin:15px auto;
    padding:12px;
    text-align:center;
    background:#007bff;
    color:white;
    font-weight:bold;
    border:none;
    border-radius:25px;
    cursor:pointer;
    transition:0.3s;
    text-decoration:none;
}

.btn:hover{
    background:#0056b3;
    transform:scale(1.05);
}

/* ===== Theme toggle ===== */
#theme-toggle{
    position:fixed;
    top:20px;
    right:20px;
    background:#007bff;
    color:white;
    border:none;
    border-radius:50%;
    width:40px;
    height:40px;
    cursor:pointer;
    font-size:18px;
    z-index:1000;
}

body.light-mode #theme-toggle{
    background:#00c6ff;
}

/* ===== Responsive ===== */
@media(max-width:768px){
    #map{height:300px;}
}
</style>
</head>

<body>

<header>
    <h1>Contact</h1>
    <p>Email : ouhoumoudmoussa91@gmail.com | T√©l√©phone : +237 6XX XXX XXX</p>
</header>

<nav class="navbar">
    <ul>
        <li><a href="index.html">Accueil</a></li>
        <li><a href="contact.html">Contact</a></li>
    </ul>
</nav>

<div class="map-container">
    <div id="map"></div>
</div>

<button class="btn" onclick="locateMe()">Me localiser üìç</button>
<button class="btn" onclick="startTracking()">Activer Tracking üöó</button>
<button class="btn" onclick="stopTracking()">Arr√™ter Tracking ‚ùå</button>

<button id="theme-toggle">üåô</button>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ===== Th√®me ===== */
const toggleBtn = document.getElementById("theme-toggle");
const body = document.body;
const prefersDark = window.matchMedia("(prefers-color-scheme: dark)");

function applyTheme(){
    if(localStorage.getItem("theme")){
        body.classList.toggle("light-mode", localStorage.getItem("theme")==="light");
        toggleBtn.textContent = body.classList.contains("light-mode")?"‚òÄÔ∏è":"üåô";
    } else {
        body.classList.toggle("light-mode", !prefersDark.matches);
        toggleBtn.textContent = body.classList.contains("light-mode")?"‚òÄÔ∏è":"üåô";
    }
}
applyTheme();

toggleBtn.addEventListener("click", ()=>{
    body.classList.toggle("light-mode");
    localStorage.setItem("theme", body.classList.contains("light-mode")?"light":"dark");
    toggleBtn.textContent = body.classList.contains("light-mode")?"‚òÄÔ∏è":"üåô";
});

/* ===== Leaflet Map ===== */
let map = L.map('map').setView([4.0511,9.7679],13);
let marker, circle;
let watchId;

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    attribution:'&copy; OpenStreetMap contributors'
}).addTo(map);

/* Localisation */
function locateMe(){
    if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(showPosition, showError,{
            enableHighAccuracy:true,
            timeout:10000,
            maximumAge:0
        });
    } else alert("G√©olocalisation non support√©e.");
}

function startTracking(){
    if(navigator.geolocation){
        watchId = navigator.geolocation.watchPosition(showPosition, showError,{
            enableHighAccuracy:true
        });
    }
}

function stopTracking(){
    if(watchId){
        navigator.geolocation.clearWatch(watchId);
        alert("Tracking arr√™t√©");
    }
}

/* Callback succ√®s */
function showPosition(position){
    const lat = position.coords.latitude;
    const lng = position.coords.longitude;
    const accuracy = position.coords.accuracy;

    map.setView([lat,lng],18);

    if(marker) map.removeLayer(marker);
    if(circle) map.removeLayer(circle);

    // Marqueur bleu visible
    const blueIcon = L.icon({
        iconUrl:'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png',
        iconSize:[25,41],
        iconAnchor:[12,41],
        popupAnchor:[1,-34],
        shadowUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
        shadowSize:[41,41]
    });

    marker = L.marker([lat,lng], {icon:blueIcon}).addTo(map)
        .bindPopup("Vous √™tes ici üìç")
        .openPopup();

    circle = L.circle([lat,lng], {radius:accuracy,color:'#00c6ff',fillOpacity:0.2}).addTo(map);
}

/* Callback erreur */
function showError(error){
    alert("Erreur de g√©olocalisation : " + error.message);
}

// Auto localiser au chargement
document.addEventListener("DOMContentLoaded", locateMe);
</script>

</body>
</html>